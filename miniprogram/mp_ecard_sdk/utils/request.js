import Log from"../constants/log";const $request=function(e,o){let{token:t="",url:a,method:r="POST",data:s,reTry:d,header:u={"Content-Type":"application/json"}}=e;console.log("requestPromise start:",a,s);try{wx.request({url:""+wx.eidBaseUrl+a,method:r,data:s,header:u,success(r){console.log("request success:",r),200===r.statusCode&&r.data?0==r.data.ErrorCode||0==r.data.code?o({ErrorCode:0,Data:r.data.Data||r.data.data,ErrorMsg:r.data.ErrorMsg,reTry:d}):o({ErrorCode:r.data.ErrorCode,ErrorMsg:r.data.ErrorMsg,Data:r.data.Data||r.data.data}):o({ErrorCode:-101,ErrorMsg:"请求错误，请稍后重试"})},fail(r){console.log("request error:",r),d&&d.tryCount&&0<d.tryCount?(d.tryCount--,wx.eidBaseUrl=wx.eidBackUpUrl,setTimeout(()=>{$request(e,o)},d.retryDelay||0)):o({ErrorCode:-107,ErrorMsg:"request请求异常，请稍后重试"}),wx.reportLogToEid({token:t,event:Log.requestFail,errCode:"",errMsg:r.errMsg,data:{url:""+wx.eidBaseUrl+a,err:r}})}})}catch(r){console.log("request error:",r),o({ErrorCode:-109,ErrorMsg:"request方法异常，请稍后重试"}),wx.reportLogToEid({token:t,event:Log.requestCatch,errCode:"",errMsg:r.errMsg,data:{url:""+wx.eidBaseUrl+a,err:r}})}};export{$request};